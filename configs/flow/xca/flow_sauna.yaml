# XCA 데이터셋 - Flow Matching 학습 설정 (SAUNA soft label)
model:
  arch_name: dhariwal_concat_unet
  image_size: 320
  patch_plan:
    - [320, 8]
  dim: 32
  timesteps: 30
  num_ensemble: 5
  sigma: 0.25
  learning_rate: 0.0002
  weight_decay: 0.00001
  num_classes: 2
  experiment_name: flow_model_sauna
  data_name: xca
  log_image_enabled: true
  log_image_names:
    - '0000.png'
    - '0010.png'
    - '0019.png'
  # UNet architecture parameters
  model_channels: 32
  channel_mult: [1, 2, 4, 8]
  channel_mult_emb: 4
  num_blocks: 3
  attn_resolutions: [16, 16, 8, 8]
  dropout: 0.0
  label_dim: 0
  augment_dim: 0
  # Loss configuration for SAUNA soft labels
  loss_type: l1_bce  # Recommended: L1 + BCE for SAUNA soft labels
  bce_weight: 0.5    # Weight for BCE loss (SAUNA soft label optimization)
  l2_weight: 0.1     # Weight for L2 loss (optional, for smoothness)
  dice_weight: 0.2   # Weight for Dice loss (optional, for segmentation quality)

data:
  name: xca
  train_dir: data/xca_full/train
  val_dir: data/xca_full/val
  test_dir: data/xca_full/test
  train_bs: 6  # DDP: 각 GPU당 1 → 총 6 GPU × 1 = 6
  image_size: 320
  num_samples_per_image: 4  # 메모리 최적화
  use_sauna_transform: true  # Enable SAUNA dynamic transformation

trainer:
  max_epochs: 500
  accelerator: gpu
  devices: 1
  precision: 16-mixed
  enable_progress_bar: false
  check_val_every_n_epoch: 25
  accumulate_grad_batches: 8  # 실효 배치: 6 GPU × 1 × 8 = 48
  gradient_clip_val: 1.0

